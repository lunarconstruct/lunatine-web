var{defineProperty:X,getOwnPropertyNames:H,getOwnPropertyDescriptor:G}=Object,_=Object.prototype.hasOwnProperty;var k=new WeakMap,y=(j)=>{var q=k.get(j),K;if(q)return q;if(q=X({},"__esModule",{value:!0}),j&&typeof j==="object"||typeof j==="function")H(j).map((B)=>!_.call(q,B)&&X(q,B,{get:()=>j[B],enumerable:!(K=G(j,B))||K.enumerable}));return k.set(j,q),q};var U=(j,q)=>{for(var K in q)X(j,K,{get:q[K],enumerable:!0,configurable:!0,set:(B)=>q[K]=()=>B})};var V={};U(V,{default:()=>$});module.exports=y(V);var Q=require("obsidian");var O=require("obsidian");var z=require("obsidian");class W extends z.AbstractInputSuggest{inputEl;constructor(j,q){super(j,q);this.inputEl=q}getSuggestions(j){let q=j.toLowerCase(),K=this.app.vault.getAllFolders(),B=this.app.vault.getFiles().filter((M)=>M.extension==="md"),J=[];return K.forEach((M)=>{let R=M.path;if(R.toLowerCase().contains(q))J.push(R+"/")}),B.forEach((M)=>{let R=M.path;if(R.toLowerCase().contains(q))J.push(R)}),J}renderSuggestion(j,q){q.setText(j)}selectSuggestion(j){this.inputEl.value=j,this.inputEl.trigger("input"),this.close()}}var Y={autoUpdate:!1,changelogPath:"Changelog.md",datetimeFormat:"YYYY-MM-DD[T]HHmm",maxRecentFiles:25,excludedFolders:[],useWikiLinks:!0,changelogHeading:""};class Z extends O.PluginSettingTab{plugin;constructor(j,q){super(j,q);this.plugin=q}renderExcludedFolders(j){if(j.empty(),this.plugin.settings.excludedFolders.length===0){j.createEl("div",{text:"No excluded folders"});return}this.plugin.settings.excludedFolders.forEach((q)=>{let K=j.createDiv("excluded-folder-item");K.createSpan({text:q}),K.createEl("button",{text:"✕",cls:"excluded-folder-remove"}).addEventListener("click",async()=>{let J=this.plugin.settings.excludedFolders.indexOf(q);if(J>-1)this.plugin.settings.excludedFolders.splice(J,1),await this.plugin.saveSettings(),this.renderExcludedFolders(j)})})}display(){let{containerEl:j}=this,{settings:q}=this.plugin;j.empty(),new O.Setting(j).setName("Auto update").setDesc("Automatically update changelog on vault changes").addToggle((B)=>B.setValue(q.autoUpdate).onChange(async(J)=>{if(q.autoUpdate=J,await this.plugin.saveSettings(),J)this.plugin.enableAutoUpdate()})),new O.Setting(j).setName("Changelog path").setDesc("Relative path including filename and extension").addText((B)=>{B.setPlaceholder("Folder/Changelog.md").setValue(q.changelogPath).onChange(async(J)=>{q.changelogPath=O.normalizePath(J),await this.plugin.saveSettings()}),new W(this.app,B.inputEl)}),new O.Setting(j).setName("Datetime format").setDesc("Moment.js datetime format string").addText((B)=>B.setPlaceholder("YYYY-MM-DD[T]HHmm").setValue(q.datetimeFormat).onChange(async(J)=>{if(window.moment().format(J)==="Invalid date"){B.setValue(q.datetimeFormat),new O.Notice("Invalid datetime format");return}q.datetimeFormat=J,await this.plugin.saveSettings()})),new O.Setting(j).setName("Max recent files").setDesc("Maximum number of recently edited files to include").addText((B)=>B.setValue(q.maxRecentFiles.toString()).onChange(async(J)=>{let M=Number(J);if(isNaN(M)||M<1){B.setValue(q.maxRecentFiles.toString());return}q.maxRecentFiles=M,await this.plugin.saveSettings()})),new O.Setting(j).setName("Use wiki-links").setDesc("Format filenames as wiki-links [[note]] instead of plain text").addToggle((B)=>B.setValue(q.useWikiLinks).onChange(async(J)=>{q.useWikiLinks=J,await this.plugin.saveSettings()})),new O.Setting(j).setName("Changelog heading").setDesc("Optional heading to prepend to the changelog (e.g., # Changelog). Leave empty for no heading.").addText((B)=>B.setPlaceholder("# Changelog").setValue(q.changelogHeading).onChange(async(J)=>{q.changelogHeading=J,await this.plugin.saveSettings()})),j.createEl("h3",{text:"Excluded folders"});let K=j.createDiv("excluded-folders-list");this.renderExcludedFolders(K),new O.Setting(j).setName("Add excluded folder").setDesc("Folders to exclude from the changelog").addText((B)=>{B.setPlaceholder("folder/path/"),new W(this.app,B.inputEl)}).addButton((B)=>{B.setButtonText("Add").onClick(async()=>{let J=B.buttonEl.parentElement?.querySelector("input");if(J){let M=J.value;if(M&&!q.excludedFolders.includes(M))q.excludedFolders.push(M),await this.plugin.saveSettings(),J.value="",this.renderExcludedFolders(K)}})})}}class $ extends Q.Plugin{settings=Y;async onload(){await this.loadSettings(),this.addSettingTab(new Z(this.app,this)),this.addCommand({id:"update-changelog",name:"Update Changelog",callback:()=>this.updateChangelog()}),this.loadStyles(),this.onVaultChange=Q.debounce(this.onVaultChange.bind(this),200),this.enableAutoUpdate()}onunload(){}async loadStyles(){let j=await this.app.vault.adapter.read(this.manifest.dir+"/styles.css");this.registerStyles(j)}registerStyles(j){let q=document.createElement("style");q.textContent=j,this.register(()=>q.remove()),document.head.appendChild(q)}enableAutoUpdate(){if(this.settings.autoUpdate)this.registerEvent(this.app.vault.on("modify",(j)=>{if(j instanceof Q.TFile)this.onVaultChange(j)})),this.registerEvent(this.app.vault.on("delete",(j)=>{if(j instanceof Q.TFile)this.onVaultChange(j)})),this.registerEvent(this.app.vault.on("rename",(j)=>{if(j instanceof Q.TFile)this.onVaultChange(j)}))}onVaultChange(j){if(j.path!==this.settings.changelogPath)this.updateChangelog()}async updateChangelog(){let j=await this.generateChangelog();await this.writeToFile(this.settings.changelogPath,j)}async generateChangelog(){let j=this.getRecentlyEditedFiles(),q="";if(this.settings.changelogHeading)q+=`${this.settings.changelogHeading}

`;return j.forEach((K)=>{let J=window.moment(K.stat.mtime).format(this.settings.datetimeFormat),M=this.settings.useWikiLinks?`[[${K.basename}]]`:K.basename;q+=`- ${J} · ${M}
`}),q}getRecentlyEditedFiles(){return this.app.vault.getMarkdownFiles().filter((j)=>{if(j.path===this.settings.changelogPath)return!1;for(let q of this.settings.excludedFolders)if(j.path.startsWith(q))return!1;return!0}).sort((j,q)=>q.stat.mtime-j.stat.mtime).slice(0,this.settings.maxRecentFiles)}async writeToFile(j,q){let K=this.app.vault.getAbstractFileByPath(j);if(!K)K=await this.app.vault.create(j,"");if(K instanceof Q.TFile)await this.app.vault.modify(K,q);else new Q.Notice(`Could not update changelog at path: ${j}`)}async loadSettings(){let j=await this.loadData();this.settings={...Y,...j}}async saveSettings(){await this.saveData(this.settings)}}

/* nosourcemap */